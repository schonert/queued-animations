//		Queued animations.
//		https://github.com/schonert/queued-animations
//		(c) 20014 Stefan Schonert, Skybrud.dk
//		You may freely distribute under the MIT license.
var Queue=function(){function a(e){try{JSON.parse(e)}catch(t){return false}return true}var e=this;this.queue=[];this.elements=[];this.group={};this.current=0;this.runningCount=0;this.debug=false;this.attributes=["queue","queue-position","queue-animation","queue-property"];this.prefix={};this.init=function(){this.elements=document.querySelectorAll("[data-queue]");for(var e=0;e<this.elements.length;e++){var t=this.elements[e],n=this.buildElement(t);this.addToQueue(n);this.addToGroups(n);this.cleanAttributes(t)}s();this.run()};this.buildElement=function(e){var t=this.getDataset(e);var n=t.queueAnimation.replace(/\s+/g,"").split(",");var r=""!==t.queuePosition?t.queuePosition.replace(/\s+/g,"").split(","):t.queue.replace(/\s+/g,"").split(",");var i=t.queueProperty.split(";");var s={node:e,position:{x:e.offsetLeft,y:e.offsetTop},dimentions:{height:e.clientHeight,width:e.clientWidth},queue:[],groups:{}};var o=Math.max(n.length,r.length);for(var u=0;u<o;u++){var f=undefined!==r[u]?r[u].split(":"):[0];var l=a(i[u])?JSON.parse(i[u]):i[u];var c={animation:n[u]||"animate",property:l||{}};if(f.length>=2&&isNaN(f[0])){var h=f[0],p=!!f[1]?f[1]:0;if(f.length===3){c.animation=f[2]}this.addGroup(h,s.groups);this.addTo(s.groups[h],p,c)}else if(f.length===2){var p=!!f[0]?f[0]:0;c.animation=f[1];this.addTo(s.queue,p,c)}else{var p=!!f[0]?f[0]:0;this.addTo(s.queue,p,c)}}if(t.queueProperty)s.property=t.queueProperty;return s};this.getData=function(e,t){return e.getAttribute("data-"+t)};this.getDataset=function(e){var n=this.attributes,r={};for(var i=0;i<n.length;i++){var s=n[i],o=this.getData(e,s)||"",u=t(s);r[u]=o}return r};this.cleanAttributes=function(e){if(this.debug)return;var t=this.attributes;for(var n=0;n<t.length;n++){e.removeAttribute("data-"+t[n])}};this.addTo=function(e,t,n){if(undefined===e[t]){e[t]=n}else if(Array.isArray(e[t])){e[t].push(n)}else if("[object Object]"===Object.prototype.toString(e[t])){var r=e[t];e[t]=[r,n]}};this.addToQueue=function(e){for(var t in e.queue){var n={node:e.node,dimentions:e.dimentions,position:e.position,animation:e.queue[t].animation,property:e.queue[t].property};this.addTo(this.queue,t,n)}};this.addToGroups=function(e){for(var t in e.groups){var n=e.groups[t];this.addGroup(t);for(var r in n){var i={node:e.node,dimentions:e.dimentions,position:e.position,animation:n[r].animation,property:n[r].property};this.addTo(this.group[t],r,i)}}};this.addGroup=function(e,t){t=t||this.group;if(!t[e]){t[e]=[]}};this.flattenElements=function(e){var t=[];var n=function(e){if(Array.isArray(e)){e.map(function(e){n(e)})}else if("[object Object]"===Object.prototype.toString(e)){t.push(e)}};n(e);return t};this.getGroupElements=function(e){var t=this.group[e];if(undefined===typeof t){return[]}return this.flattenElements(t)};this.run=function(e){run(e)};this.filter=function(e,t){var n=this.group[e]||this.queue;n=n.filter(function(e){return e});for(var r=0;r<n.length;r++){var i=n[r];if(!Array.isArray(i)){i=[i]}for(var s=0;s<i.length;s++){element=i[s];t(element)}}};run=function(e){var t=this.group[e]||this.queue,n=0,i=0;if(t==window){return}t=t.filter(function(e){return e});var s=function(){var e=t[n];if(!e){n++}if(!Array.isArray(e)){e=[e]}i=e.length;for(var s=0;s<e.length;s++){var f=e[s];if(!f||!f.hasOwnProperty("animation")){i--;continue}if(f["animation"]==="animate"){f.node.classList.remove("queue-"+f["animation"]+"-done")}else{f.node.classList.remove(f["animation"]+"-done")}if("function"===typeof window[f.animation]){window[f.animation](f,a)}else{if(f["animation"]==="animate"){r(f.node,"queue-"+f["animation"])}else{r(f.node,f["animation"])}if(u(f.node)){o(f.node,"TransitionEnd",a.bind(undefined,f));o(f.node,"AnimationEnd",a.bind(undefined,f))}else{console.log("run");a(f)}}}};var a=function(e){i--;if("function"===typeof window[e.animation+"-done"]){window[e.animation+"-done"](e,a)}else{if(e["animation"]==="animate"){r(e.node,"queue-"+e["animation"]+"-done")}else{r(e.node,e["animation"]+"-done")}}if(i!==0)return;i=0;n++;s()};s()};var t=function(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})};var n=function(e,t){return(new RegExp("(\\s|^)"+t+"(\\s|$)")).test(e.className)};var r=function(e,t){if(!n(e,t)){e.className+=(e.className?" ":"")+t}};var i=function(e,t){if(n(e,t)){e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," ").replace(/^\s+|\s+$/g,"")}};var s=function(){var e=window.getComputedStyle(document.documentElement,""),t=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||e.OLink===""&&["","o"])[1],n="WebKit|Moz|MS|O".match(new RegExp("("+t+")","i"))[1];this.prefix={dom:n,lowercase:t,css:"-"+t+"-",js:t[0].toUpperCase()+t.substr(1)}};var o=function(e,t,n){var r=["webkit","moz","MS","o",""];for(var i=0;i<r.length;i++){if(!r[i])t=t.toLowerCase();e.addEventListener(r[i]+t,n,false)}};var u=function(e){var t=e.style["transition"]||e.style[prefix["js"]+"Transition"],n=e.style["animation"]||e.style[prefix["js"]+"Animation"];if(!!t||!!n){return true}else{var r=getComputedStyle(e);t=r["transition"];n=r["animation"];return!!t||!!n}};this.init.apply(this,arguments);return this}